<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <meta charset="UTF-8">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='favicon/apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon/favicon-16x16.png') }}">
  <title>{% if lang == 'en' %}Browse Lessons{% else %}Explorer les leçons{% endif %}</title>

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- MathJax -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" defer></script>

<style>
/* ===== VARIABLES ===== */
:root {
  --primary:#4361ee;
  --secondary:#3a0ca3;
  --accent:#f72585;
  --success:#4cc9f0;
  --warning:#f9c74f;
  --light:#f8f9fa;
  --dark:#212529;
  --gray:#6c757d;
}

/* ===== BASE ===== */
body{
  font-family:Segoe UI,system-ui;
  background:linear-gradient(135deg,#f5f7fa,#c3cfe2);
  padding:20px;
}
.container{max-width:1200px;margin:auto}
h1{text-align:center;color:var(--secondary)}

/* ===== CARTE ÉLÈVE ===== */
.student-card{
  background:white;
  padding:20px;
  border-radius:15px;
  display:flex;
  gap:15px;
  margin:30px 0;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
}

/* ===== NIVEAU ===== */
.niveau-bloc{
  background:white;
  border-radius:16px;
  padding:25px;
  margin-bottom:30px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
}
.niveau-header{
  display:flex;
  align-items:center;
  gap:15px;
  margin-bottom:15px;
}
.niveau-icon{
  width:50px;height:50px;
  background:var(--primary);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
}

/* ===== ACCORDÉON MATIÈRE ===== */
.matiere-header,
.unite-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:15px;
  background:var(--light);
  border-radius:12px;
  cursor:pointer;
}
.matiere-header{margin-top:15px}
.toggle-icon{
  transition:transform .3s;
}
.active .toggle-icon{
  transform:rotate(180deg);
}
.matiere-content,
.unite-content{
  display:none;
  margin-top:15px;
  padding-left:10px;
}

/* ===== UNITÉ ===== */
.unite-card{
  background:#eef2ff;
  padding:15px;
  border-radius:12px;
  margin-bottom:15px;
}

/* ===== LEÇON ===== */
.lecon-item{
  background:white;
  padding:15px;
  border-radius:10px;
  margin:10px 0;
}
.lecon-link{
  font-weight:bold;
  color:var(--primary);
  text-decoration:none;
}
.lecon-link:hover{color:var(--secondary)}

/* ===== EXERCICES ===== */
.exercice-item{
  background:var(--light);
  padding:10px;
  border-radius:8px;
  margin-top:8px;
}
.status-done{color:var(--success)}
.status-pending{color:var(--warning)}
.action-btn{
  display:inline-block;
  margin-top:6px;
  padding:6px 14px;
  border-radius:20px;
  background:var(--primary);
  color:white;
  text-decoration:none;
  font-size:.85rem;
}
.action-btn.secondary{
  background:#ddd;color:#333;
}

/* ===== PROGRESS ===== */
.progress{
  background:#ddd;
  border-radius:6px;
  height:6px;
  margin-top:10px;
}
.progress-fill{
  background:var(--success);
  height:100%;
  border-radius:6px;
}

/* ===== RETOUR ===== */
.back-link{
  display:inline-block;
  margin:30px auto;
  text-decoration:none;
  background:white;
  padding:12px 25px;
  border-radius:30px;
  color:var(--accent);
  font-weight:bold;
}
</style>
</head>

<body>
<div class="container">

<h1><i class="fas fa-book-open"></i> Explorer les leçons</h1>

<div class="student-card">
  <i class="fas fa-user-graduate fa-2x"></i>
  <div>
    <h3>{{ eleve.nom_complet }}</h3>
    <p>Progression générale</p>
  </div>
</div>

{% for niveau in niveaux %}
<div class="niveau-bloc">

  <div class="niveau-header">
    <div class="niveau-icon"><i class="fas fa-graduation-cap"></i></div>
    <h2>{{ niveau.nom }}</h2>
  </div>

  {% for matiere in niveau.matieres %}
  <div class="matiere-header toggle-matiere">
    <span><i class="fas fa-atom"></i> {{ matiere.nom }}</span>
    <i class="fas fa-chevron-down toggle-icon"></i>
  </div>

  <div class="matiere-content">
    {% for unite in matiere.unites %}
    <div class="unite-card">

      <div class="unite-header toggle-unite">
        <strong>{{ unite.nom }}</strong>
        <i class="fas fa-chevron-down toggle-icon"></i>
      </div>

      <div class="unite-content">

        {% for lecon in unite.lecons %}
        <div class="lecon-item">
          <a class="lecon-link"
             href="/lecon/{{ lecon.id }}?username={{ eleve.username }}&lang={{ lang }}">
            {{ lecon.titre_fr }}
          </a>

          {% for ex in lecon.exercices %}
          <div class="exercice-item">
            {{ ex.question_fr[:80] }}...
            {% if ex.id in exercices_faits %}
              <div class="status-done">✔ Fait</div>
              <a class="action-btn secondary"
                 href="/historique?exercice_id={{ ex.id }}&username={{ eleve.username }}">
                 Analyse
              </a>
            {% else %}
              <div class="status-pending">⏳ À faire</div>
              <a class="action-btn"
                 href="/exercice/{{ ex.id }}?username={{ eleve.username }}">
                 Commencer
              </a>
            {% endif %}
          </div>
          {% endfor %}
        </div>
        {% endfor %}

      </div>
    </div>
    {% endfor %}
  </div>
  {% endfor %}
</div>
{% endfor %}

<div style="text-align:center">
  <a class="back-link" href="/dashboard-eleve?username={{ eleve.username }}">
    ← Retour tableau de bord
  </a>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

  document.querySelectorAll(".toggle-matiere").forEach(h=>{
    h.onclick=()=>{
      h.classList.toggle("active");
      const c=h.nextElementSibling;
      c.style.display = c.style.display==="block"?"none":"block";
    };
  });

  document.querySelectorAll(".toggle-unite").forEach(h=>{
    h.onclick=()=>{
      h.classList.toggle("active");
      const c=h.nextElementSibling;
      c.style.display = c.style.display==="block"?"none":"block";
    };
  });

});
</script>
</body>
</html>
