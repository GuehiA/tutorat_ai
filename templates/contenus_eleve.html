<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <meta charset="UTF-8">
  <title>{% if lang=='en' %}Browse Lessons{% else %}Explorer les leçons{% endif %}</title>

  <!-- Font Awesome -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
  :root{
    --primary:#4f46e5;
    --secondary:#312e81;
    --accent:#ec4899;
    --success:#22c55e;
    --warning:#f59e0b;
    --bg:#f4f6fb;
    --card:#ffffff;
    --muted:#6b7280;
  }

  *{box-sizing:border-box}

  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system;
    background:radial-gradient(circle at top,#eef2ff,#f9fafb);
    color:#111827;
    padding:24px;
  }

  .container{
    max-width:1200px;
    margin:auto;
  }

  /* HEADER */
  h1{
    text-align:center;
    font-size:2.4rem;
    font-weight:800;
    margin-bottom:30px;
    color:var(--secondary);
  }

  /* ELEVE */
  .student-card{
    background:var(--card);
    border-radius:22px;
    padding:20px;
    display:flex;
    gap:16px;
    align-items:center;
    box-shadow:0 12px 40px rgba(0,0,0,.1);
    margin-bottom:30px;
  }

  .student-avatar{
    width:60px;height:60px;
    border-radius:50%;
    background:linear-gradient(135deg,var(--primary),var(--accent));
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-size:1.4rem;
  }

  /* NIVEAU */
  .niveau{
    background:var(--card);
    border-radius:26px;
    padding:30px;
    margin-bottom:30px;
    box-shadow:0 20px 50px rgba(0,0,0,.12);
  }

  .niveau-header{
    display:flex;
    align-items:center;
    gap:15px;
    margin-bottom:20px;
  }

  .niveau-icon{
    width:50px;height:50px;
    border-radius:50%;
    background:var(--primary);
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
  }

  /* MATIERE */
  .matiere-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:18px 22px;
    background:linear-gradient(135deg,#eef2ff,#fff);
    border-radius:18px;
    margin-top:16px;
    cursor:pointer;
    transition:.35s;
    border:1px solid #e5e7eb;
  }

  .matiere-header:hover{
    transform:translateY(-2px);
    box-shadow:0 12px 30px rgba(79,70,229,.18);
  }

  .matiere-title{
    font-weight:700;
    font-size:1.15rem;
  }

  .matiere-content,
  .unite-content{
    display:none;
    margin-top:18px;
    padding-left:12px;
  }

  /* UNITE */
  .unite-card{
    background:rgba(255,255,255,.75);
    backdrop-filter:blur(10px);
    border-radius:20px;
    padding:18px;
    margin-bottom:16px;
    border:1px solid #e5e7eb;
  }

  .unite-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    cursor:pointer;
    font-weight:700;
  }

  /* LECON */
  .lecon-item{
    background:#fff;
    border-radius:16px;
    padding:16px;
    margin-top:14px;
    border-left:5px solid var(--primary);
    transition:.25s;
  }

  .lecon-item:hover{
    transform:translateX(4px);
    box-shadow:0 10px 25px rgba(0,0,0,.12);
  }

  .lecon-link{
    display:block;
    font-size:1.05rem;
    font-weight:700;
    text-decoration:none;
    color:var(--primary);
    margin-bottom:8px;
  }

  /* EXERCICE */
  .exercice{
    background:#f9fafb;
    padding:12px;
    border-radius:12px;
    margin-top:8px;
  }

  .done{color:var(--success);font-weight:700}
  .pending{color:var(--warning);font-weight:700}

  .btn{
    display:inline-block;
    margin-top:6px;
    padding:7px 18px;
    border-radius:999px;
    font-size:.85rem;
    font-weight:600;
    text-decoration:none;
    background:var(--primary);
    color:white;
  }

  .btn.secondary{
    background:#e5e7eb;
    color:#111827;
  }

  .toggle-icon{
    transition:transform .3s;
    color:var(--muted);
  }

  .active .toggle-icon{
    transform:rotate(180deg);
  }

  /* RETOUR */
  .back{
    display:block;
    width:fit-content;
    margin:40px auto 0;
    background:white;
    padding:14px 30px;
    border-radius:999px;
    box-shadow:0 8px 24px rgba(0,0,0,.12);
    color:var(--accent);
    font-weight:700;
    text-decoration:none;
  }

  @media(max-width:768px){
    body{padding:14px}
    h1{font-size:1.8rem}
  }
  </style>
</head>

<body>
<div class="container">

<!-- CORRECTION : Utiliser la variable lang pour le titre -->
<h1><i class="fas fa-book-open"></i> {% if lang=='en' %}Browse Lessons{% else %}Explorer les leçons{% endif %}</h1>

<div class="student-card">
  <div class="student-avatar"><i class="fas fa-user-graduate"></i></div>
  <div>
    <strong>{{ eleve.nom_complet }}</strong>
    <!-- CORRECTION : Texte selon la langue -->
    <div style="color:var(--muted)">
      {% if lang=='en' %}Personalized learning journey{% else %}Parcours personnalisé{% endif %}
    </div>
  </div>
</div>

{% for niveau in niveaux %}
<div class="niveau">

  <div class="niveau-header">
    <div class="niveau-icon"><i class="fas fa-graduation-cap"></i></div>
    <!-- CORRECTION : Utiliser nom_en si anglais, sinon nom -->
    <h2>{{ niveau.nom_en if lang=='en' and niveau.nom_en else niveau.nom }}</h2>
  </div>

  {% for matiere in niveau.matieres %}
  <div class="matiere-header toggle-matiere">
    <!-- CORRECTION : Utiliser nom_en si anglais, sinon nom -->
    <span class="matiere-title"><i class="fas fa-layer-group"></i> 
      {{ matiere.nom_en if lang=='en' and matiere.nom_en else matiere.nom }}
    </span>
    <i class="fas fa-chevron-down toggle-icon"></i>
  </div>

  <div class="matiere-content">
    {% for unite in matiere.unites %}
    <div class="unite-card">
      <div class="unite-header toggle-unite">
        <!-- CORRECTION : Utiliser nom_en si anglais, sinon nom -->
        <span><i class="fas fa-cube"></i> 
          {{ unite.nom_en if lang=='en' and unite.nom_en else unite.nom }}
        </span>
        <i class="fas fa-chevron-down toggle-icon"></i>
      </div>

      <div class="unite-content">
        {% for lecon in unite.lecons %}
        <div class="lecon-item">
          <!-- CORRECTION : Utiliser titre_en si anglais, sinon titre_fr -->
          <a class="lecon-link"
             href="/lecon/{{ lecon.id }}?username={{ eleve.username }}&lang={{ lang }}">
            {{ lecon.titre_en if lang=='en' and lecon.titre_en else lecon.titre_fr }}
          </a>

          {% for ex in lecon.exercices %}
          <div class="exercice">
            <!-- CORRECTION : Utiliser question_en si anglais, sinon question_fr -->
            {% if lang=='en' and ex.question_en %}
              {{ ex.question_en[:80] }}…
            {% else %}
              {{ ex.question_fr[:80] }}…
            {% endif %}
            
            {% if ex.id in exercices_faits %}
              <!-- CORRECTION : Texte selon la langue -->
              <div class="done">{% if lang=='en' %}✔ Done{% else %}✔ Fait{% endif %}</div>
              <a class="btn secondary"
                 href="/historique?exercice_id={{ ex.id }}&username={{ eleve.username }}&lang={{ lang }}">
                 {% if lang=='en' %}Analysis{% else %}Analyse{% endif %}
              </a>
            {% else %}
              <!-- CORRECTION : Texte selon la langue -->
              <div class="pending">{% if lang=='en' %}⏳ Pending{% else %}⏳ À faire{% endif %}</div>
              <a class="btn"
                 href="/exercice/{{ ex.id }}?username={{ eleve.username }}&lang={{ lang }}">
                 {% if lang=='en' %}Start{% else %}Commencer{% endif %}
              </a>
            {% endif %}
          </div>
          {% endfor %}
        </div>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% endfor %}

</div>
{% endfor %}

<!-- CORRECTION : Texte selon la langue -->
<a class="back" href="/dashboard-eleve?username={{ eleve.username }}&lang={{ lang }}">
  ← {% if lang=='en' %}Back to dashboard{% else %}Retour au tableau de bord{% endif %}
</a>

</div>

<script>
document.querySelectorAll(".toggle-matiere").forEach(h=>{
  h.onclick=()=>{
    h.classList.toggle("active");
    const c=h.nextElementSibling;
    c.style.display = c.style.display==="block"?"none":"block";
  }
});

document.querySelectorAll(".toggle-unite").forEach(h=>{
  h.onclick=()=>{
    h.classList.toggle("active");
    const c=h.nextElementSibling;
    c.style.display = c.style.display==="block"?"none":"block";
  }
});
</script>
</body>
</html>