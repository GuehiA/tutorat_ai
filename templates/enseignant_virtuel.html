<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <meta charset="UTF-8">

  <!-- Favicon VirtuEduc -->
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='favicon/apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon/favicon-16x16.png') }}">
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon/favicon.ico') }}">

  <meta name="theme-color" content="#4361ee">

  <title>{% if lang == 'en' %}Teacher Dashboard{% else %}Tableau de bord Enseignant{% endif %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      min-height: 100vh;
      padding: 20px;
    }

    .main-container {
      max-width: 1200px;
      margin: auto;
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }

    .header-section {
      background: linear-gradient(135deg, #4361ee, #3a56d4);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
    }

    .teacher-avatar {
      width: 80px;
      height: 80px;
      margin: auto;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .content-section {
      padding: 30px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: #f8f9ff;
      border-radius: 14px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }

    .stat-number {
      font-size: 2.3rem;
      font-weight: bold;
      color: #4361ee;
    }

    .chart-container {
      background: #f8f9ff;
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    }

    .chart-title {
      font-weight: 600;
      margin-bottom: 15px;
      color: #4361ee;
    }

    .logout-btn {
      border: 2px solid #e85959;
      padding: 10px 30px;
      border-radius: 12px;
      color: #e85959;
      text-decoration: none;
      font-weight: 600;
    }

    .logout-btn:hover {
      background: #e85959;
      color: white;
    }
  </style>
</head>

<body>

<div class="main-container">

  <!-- HEADER -->
  <div class="header-section">
    <div class="teacher-avatar"><i class="fas fa-chalkboard-teacher"></i></div>
    <h1>
      {% if lang == 'en' %}Welcome{% else %}Bienvenue{% endif %} {{ enseignant.nom }}
    </h1>
    <p>
      {% if lang == 'en' %}
        Pedagogical & AI supervision dashboard
      {% else %}
        Tableau de bord p√©dagogique & IA
      {% endif %}
    </p>
  </div>

  <!-- CONTENT -->
  <div class="content-section">

    <!-- STATS -->
    <div class="stats-grid">
      <div class="stat-card">
        üë•
        <div class="stat-number">{{ total_students or 0 }}</div>
        √âl√®ves
      </div>
      <div class="stat-card">
        üìö
        <div class="stat-number">{{ total_lessons or 0 }}</div>
        Le√ßons
      </div>
      <div class="stat-card">
        ‚≠ê
        <div class="stat-number">{{ avg_stars or 0 }}/5</div>
        Moyenne
      </div>
      <div class="stat-card">
        üöß
        <div class="stat-number">{{ nv_count or 0 }}</div>
        Rem√©diations
      </div>
    </div>

    <!-- IA ANALYSES -->
    <h3 class="mb-3">üß† Analyses p√©dagogiques IA</h3>

    <div class="row">
      <div class="col-md-6">
        <div class="chart-container">
          <div class="chart-title">üìò Chapitres les plus travaill√©s</div>
          <canvas id="chapitresIA"></canvas>
        </div>
      </div>

      <div class="col-md-6">
        <div class="chart-container">
          <div class="chart-title text-danger">üö® Alertes p√©dagogiques</div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              ‚ö†Ô∏è {{ ai_stats.tentatives_excessives }} d√©passements de tentatives IA
            </li>
            <li class="list-group-item">
              üö© √âl√®ves en difficult√© :
              <strong>{{ ai_stats.eleves_risque | join(', ') }}</strong>
            </li>
            <li class="list-group-item">
              üéØ Niveau d√©tect√© automatiquement (primaire / secondaire)
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- LOGOUT -->
    <div class="text-center mt-4">
      <a href="/logout" class="logout-btn">
        <i class="fas fa-sign-out-alt"></i> D√©connexion
      </a>
    </div>

  </div>
</div>

<script>
const ctx = document.getElementById('chapitresIA');

new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: {{ ai_stats.chapitres | tojson }},
    datasets: [{
      data: {{ ai_stats.chapitre_counts | tojson }},
      backgroundColor: ['#4361ee', '#3fba83', '#fcc419', '#e85959']
    }]
  },
  options: {
    plugins: {
      legend: { position: 'bottom' }
    }
  }
});
</script>

</body>
</html>
