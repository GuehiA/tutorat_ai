<!DOCTYPE html>
<html lang="{{ lang }}" data-theme="light">
<head>
  <meta charset="UTF-8">
  <!-- Favicon VirtuEduc -->
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='favicon/apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon/favicon-16x16.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='favicon/site.webmanifest') }}">
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon/favicon.ico') }}">
  <meta name="msapplication-TileColor" content="#4361ee">
  <meta name="theme-color" content="#4361ee">
  <title>{% if lang == 'en' %}Admin Dashboard{% else %}Tableau de Bord Admin{% endif %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --primary-light: #e0e7ff;
      --success: #3fba83;
      --success-dark: #38a873;
      --success-light: #e0f7ed;
      --warning: #fcc419;
      --warning-dark: #e6b017;
      --warning-light: #fff9e6;
      --danger: #e85959;
      --danger-dark: #d14f4f;
      --danger-light: #fdeaea;
      --info: #17a2b8;
      --info-dark: #148ea1;
      --info-light: #e3f4f7;
      --light: #f8f9ff;
      --dark: #121826;
      --card-bg: rgba(255, 255, 255, 0.9);
      --text: #2d3748;
      --text-light: #718096;
      --border: #e2e8f0;
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
      --radius: 12px;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    [data-theme="dark"] {
      --light: #121826;
      --dark: #f8f9ff;
      --card-bg: rgba(30, 30, 46, 0.8);
      --text: #e2e8f0;
      --text-light: #a0aec0;
      --border: #2d3748;
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 20px 40px -10px rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--light) 0%, #e8eaff 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
      transition: var(--transition);
      line-height: 1.6;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
    }

    .dashboard-header {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 25px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeInDown 0.6s ease-out;
    }

    .dashboard-card {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
      opacity: 0;
      animation: fadeInUp 0.6s ease-out forwards;
      height: 100%;
    }

    .dashboard-card:nth-child(1) { animation-delay: 0.1s; }
    .dashboard-card:nth-child(2) { animation-delay: 0.2s; }
    .dashboard-card:nth-child(3) { animation-delay: 0.3s; }

    .dashboard-card:hover {
      transform: translateY(-8px) scale(1.01);
      box-shadow: var(--shadow-lg);
    }

    .dashboard-card .card-header { 
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      padding: 25px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 12px;
      height: 80px;
    }

    .dashboard-card .card-body {
      padding: 25px;
      min-height: 280px;
      display: flex;
      flex-direction: column;
    }

    .nav-tabs {
      border-bottom: 1px solid var(--border);
      margin-bottom: 25px;
    }

    .nav-tabs .nav-link {
      border: none;
      border-radius: var(--radius) var(--radius) 0 0;
      font-weight: 500;
      padding: 15px 25px;
      color: var(--text-light);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .nav-tabs .nav-link::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--primary);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .nav-tabs .nav-link.active {
      background-color: transparent;
      color: var(--primary);
      font-weight: 600;
    }

    .nav-tabs .nav-link.active::before {
      transform: scaleX(1);
    }

    .content-section {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 25px;
      margin-top: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: fadeIn 0.6s ease-out;
    }

    .action-btn {
      border-radius: 10px;
      padding: 14px 18px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: var(--transition);
      text-decoration: none;
      position: relative;
      overflow: hidden;
      border: none;
      width: 100%;
      justify-content: flex-start;
      margin-bottom: 10px;
      text-align: left;
      font-size: 0.95rem;
      background: rgba(255, 255, 255, 0.7);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .action-btn::after {
      content: "";
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.2);
      transform: scaleX(0);
      transform-origin: right;
      transition: transform 0.3s ease;
    }

    .action-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      border-color: transparent;
    }

    .action-btn:hover::after {
      transform: scaleX(1);
      transform-origin: left;
    }

    .action-btn i {
      font-size: 1.1rem;
      width: 24px;
      text-align: center;
    }

    /* User Management */
    .user-management .card-header { 
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
    }
    .user-management .action-btn:hover { 
      background: linear-gradient(135deg, var(--primary-light) 0%, #d0d9ff 100%);
      color: var(--primary-dark);
    }
    .user-management .action-btn i { 
      color: var(--primary);
    }

    /* Content Management */
    .content-management .card-header { 
      background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
      color: white;
    }
    .content-management .action-btn:hover { 
      background: linear-gradient(135deg, var(--success-light) 0%, #c0ebd9 100%);
      color: var(--success-dark);
    }
    .content-management .action-btn i { 
      color: var(--success);
    }

    /* Evaluations */
    .evaluations .card-header { 
      background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
      color: white;
    }
    .evaluations .action-btn:hover { 
      background: linear-gradient(135deg, var(--warning-light) 0%, #ffeccc 100%);
      color: var(--warning-dark);
    }
    .evaluations .action-btn i { 
      color: var(--warning);
    }

    .stats-card {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      text-align: center;
      margin-bottom: 20px;
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    .stats-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--success));
    }

    .stats-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .stats-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .stats-label {
      font-size: 0.9rem;
      color: var(--text-light);
      font-weight: 500;
    }

    .lang-selector {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      padding: 10px 15px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .theme-toggle {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-radius: 50%;
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
      cursor: pointer;
      transition: var(--transition);
      margin-left: 10px;
    }

    .theme-toggle:hover {
      transform: rotate(15deg);
    }

    .logout-btn {
      background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
      color: white;
      border: none;
      border-radius: 30px;
      padding: 12px 25px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
      text-decoration: none;
      cursor: pointer;
      margin-left: 10px;
    }

    .logout-btn:hover {
      background: linear-gradient(135deg, var(--danger-dark) 0%, #c44545 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    /* Cartes align√©es */
    .quick-actions-row {
      margin-top: 20px;
    }

    .card-icon {
      font-size: 1.5rem;
    }

    /* Styles pour la Structure du Contenu (Accord√©on imbriqu√©) */
    .content-actions {
      display: flex;
      gap: 10px;
    }
    
    /* Accord√©on principal */
    .nested-accordion {
      border: none;
    }
    
    .nested-accordion .accordion-item {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 10px;
      overflow: hidden;
    }
    
    .nested-accordion .accordion-button {
      background: white;
      padding: 20px;
      font-weight: 600;
      box-shadow: none;
      border: none;
    }
    
    .nested-accordion .accordion-button:not(.collapsed) {
      background: white;
      color: inherit;
      box-shadow: none;
    }
    
    .nested-accordion .accordion-button:focus {
      box-shadow: none;
      border-color: transparent;
    }
    
    .nested-accordion .accordion-body {
      padding: 0;
    }
    
    /* Accord√©on de niveau 2 (Mati√®res) */
    .level-2-accordion {
      border: none;
      background: rgba(248, 249, 255, 0.5);
    }
    
    .level-2-accordion .accordion-item {
      border: none;
      border-bottom: 1px solid var(--border);
      border-radius: 0;
      margin: 0;
    }
    
    .level-2-accordion .accordion-item:last-child {
      border-bottom: none;
    }
    
    .level-2-accordion .accordion-button {
      background: rgba(63, 186, 131, 0.1);
      padding: 18px 20px;
      font-weight: 500;
    }
    
    .level-2-accordion .accordion-button:not(.collapsed) {
      background: rgba(63, 186, 131, 0.15);
    }
    
    /* Accord√©on de niveau 3 (Unit√©s) */
    .level-3-accordion {
      border: none;
      background: rgba(248, 249, 255, 0.3);
    }
    
    .level-3-accordion .accordion-item {
      border: none;
      border-bottom: 1px solid var(--border);
      margin: 0;
    }
    
    .level-3-accordion .accordion-item:last-child {
      border-bottom: none;
    }
    
    .level-3-accordion .accordion-button {
      background: rgba(23, 162, 184, 0.1);
      padding: 16px 20px 16px 30px;
      font-weight: 500;
    }
    
    .level-3-accordion .accordion-button:not(.collapsed) {
      background: rgba(23, 162, 184, 0.15);
    }
    
    /* Accord√©on de niveau 4 (Le√ßons) */
    .level-4-accordion {
      border: none;
      background: rgba(248, 249, 255, 0.2);
    }
    
    .level-4-accordion .accordion-item {
      border: none;
      border-bottom: 1px solid var(--border);
      margin: 0;
    }
    
    .level-4-accordion .accordion-item:last-child {
      border-bottom: none;
    }
    
    .level-4-accordion .accordion-button {
      background: rgba(108, 117, 125, 0.1);
      padding: 14px 20px 14px 40px;
      font-weight: 400;
    }
    
    .level-4-accordion .accordion-button:not(.collapsed) {
      background: rgba(108, 117, 125, 0.15);
    }
    
    /* Exercices (pas d'accord√©on) */
    .exercises-container {
      padding: 15px 20px 15px 50px;
      background: white;
    }
    
    .exercise-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 8px;
      background: rgba(248, 249, 255, 0.5);
      border: 1px solid var(--border);
      transition: var(--transition);
    }
    
    .exercise-item:hover {
      background: rgba(67, 97, 238, 0.05);
      transform: translateX(5px);
    }
    
    /* En-t√™tes des accord√©ons */
    .accordion-header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }
    
    .accordion-title {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }
    
    .accordion-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }
    
    .level-icon {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    }
    
    .subject-icon {
      background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
    }
    
    .unit-icon {
      background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
    }
    
    .lesson-icon {
      background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
    }
    
    .test-icon {
      background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
    }
    
    .accordion-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .badge-count {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      min-width: 40px;
      text-align: center;
    }
    
    /* Actions */
    .accordion-actions {
      display: flex;
      gap: 5px;
      opacity: 0;
      transition: var(--transition);
    }
    
    .accordion-item:hover .accordion-actions {
      opacity: 1;
    }
    
    .action-button {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
    }
    
    .edit-btn {
      background: var(--success);
    }
    
    .edit-btn:hover {
      background: var(--success-dark);
      transform: scale(1.1);
    }
    
    .delete-btn {
      background: var(--danger);
    }
    
    .delete-btn:hover {
      background: var(--danger-dark);
      transform: scale(1.1);
    }
    
    .view-btn {
      background: var(--info);
    }
    
    .view-btn:hover {
      background: var(--info-dark);
      transform: scale(1.1);
    }
    
    /* Section des tests */
    .tests-section {
      padding: 15px 20px 15px 40px;
    }
    
    .test-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      background: rgba(252, 196, 25, 0.1);
      border: 1px solid rgba(252, 196, 25, 0.3);
    }
    
    /* √âtats vides */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-light);
    }
    
    .empty-state-icon {
      font-size: 3rem;
      color: var(--border);
      margin-bottom: 15px;
      opacity: 0.5;
    }
    
    /* Boutons Expand/Collapse */
    .content-actions .btn {
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 0.9rem;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .dashboard-header {
        padding: 20px;
      }
      
      .stats-number {
        font-size: 2rem;
      }
      
      .nav-tabs .nav-link {
        padding: 12px 15px;
        font-size: 0.9rem;
      }
      
      .dashboard-card .card-header {
        padding: 20px;
        height: auto;
        flex-wrap: wrap;
      }
      
      .action-btn {
        padding: 12px 15px;
        font-size: 0.9rem;
      }
      
      .logout-btn {
        padding: 10px 15px;
        font-size: 0.9rem;
        margin-left: 5px;
      }
      
      .accordion-header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .accordion-actions {
        align-self: flex-end;
        opacity: 1;
      }
      
      .accordion-info {
        flex-wrap: wrap;
        gap: 8px;
      }
    }

    @media (max-width: 576px) {
      .quick-actions-row .col-md-4 {
        margin-bottom: 20px;
      }
      
      .content-actions {
        flex-direction: column;
        width: 100%;
      }
      
      .content-actions .btn {
        width: 100%;
      }
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <!-- Header avec s√©lecteur de langue, th√®me et bouton de d√©connexion -->
  <div class="dashboard-header">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h1 class="h3 mb-1">{% if lang == 'en' %}üõ†Ô∏è Admin Dashboard{% else %}üõ†Ô∏è Tableau de Bord Administrateur{% endif %}</h1>
        <p class="text-muted mb-0">{% if lang == 'en' %}Manage your educational platform{% else %}G√©rez votre plateforme √©ducative{% endif %}</p>
      </div>
      <div class="col-md-6 text-end">
        <div class="d-flex justify-content-end align-items-center">
          <div class="lang-selector d-inline-block me-2">
            <form method="POST" action="/changer-langue" class="d-flex align-items-center">
              <label for="lang" class="me-2">üåç</label>
              <select name="lang" id="lang" onchange="this.form.submit()" class="form-select form-select-sm border-0 bg-transparent">
                <option value="fr" {% if lang == 'fr' %}selected{% endif %}>üá´üá∑ Fran√ßais</option>
                <option value="en" {% if lang == 'en' %}selected{% endif %}>üá¨üáß English</option>
              </select>
              <input type="hidden" name="redirect_page" value="admin_dashboard">
            </form>
          </div>
          <a href="/logout" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            {% if lang == 'en' %}Logout{% else %}D√©connexion{% endif %}
          </a>
          <div class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cartes de statistiques rapides - TROIS CARTES SUR LA M√äME LIGNE -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="stats-card">
        <div class="stats-number">{{ stats.enseignants_count if stats else '24' }}</div>
        <div class="stats-label">{% if lang == 'en' %}Teachers{% else %}Enseignants{% endif %}</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stats-card">
        <div class="stats-number">{{ stats.eleves_count if stats else '156' }}</div>
        <div class="stats-label">{% if lang == 'en' %}Students{% else %}√âl√®ves{% endif %}</div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stats-card">
        <div class="stats-number">{{ stats.lecons_count if stats else '42' }}</div>
        <div class="stats-label">{% if lang == 'en' %}Lessons{% else %}Le√ßons{% endif %}</div>
      </div>
    </div>
  </div>

  <!-- Navigation par onglets -->
  <ul class="nav nav-tabs" id="adminTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="actions-tab" data-bs-toggle="tab" data-bs-target="#actions" type="button" role="tab">
        <i class="fas fa-tachometer-alt me-2"></i>{% if lang == 'en' %}Quick Actions{% else %}Actions Rapides{% endif %}
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="content-tab" data-bs-toggle="tab" data-bs-target="#content" type="button" role="tab">
        <i class="fas fa-sitemap me-2"></i>{% if lang == 'en' %}Content Structure{% else %}Structure du Contenu{% endif %}
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab">
        <i class="fas fa-chart-bar me-2"></i>{% if lang == 'en' %}Analytics{% else %}Analytiques{% endif %}
      </button>
    </li>
  </ul>

  <!-- Contenu des onglets -->
  <div class="tab-content" id="adminTabsContent">
    <!-- Onglet Actions Rapides - TROIS CARTES ALIGN√âES -->
    <div class="tab-pane fade show active" id="actions" role="tabpanel">
      <div class="row quick-actions-row">
        <!-- Gestion des Utilisateurs -->
        <div class="col-md-4">
          <div class="dashboard-card user-management">
            <div class="card-header">
              <i class="fas fa-users card-icon"></i>
              {% if lang == 'en' %}User Management{% else %}Gestion des Utilisateurs{% endif %}
            </div>
            <div class="card-body">
              <a href="/inscription-enseignant" class="btn action-btn">
                <i class="fas fa-plus-circle"></i>
                {% if lang == 'en' %}Add Teacher{% else %}Ajouter un Enseignant{% endif %}
              </a>
              <a href="/admin/creer-eleve" class="btn action-btn">
                <i class="fas fa-user-plus"></i>
                {% if lang == 'en' %}Add Student{% else %}Ajouter un √âl√®ve{% endif %}
              </a>
              <a href="/admin-enseignants" class="btn action-btn">
                <i class="fas fa-user-edit"></i>
                {% if lang == 'en' %}Manage Teachers{% else %}G√©rer les Enseignants{% endif %}
              </a>
              <a href="/admin/eleves" class="btn action-btn">
                <i class="fas fa-user-graduate"></i>
                {% if lang == 'en' %}Manage Students{% else %}G√©rer les √âl√®ves{% endif %}
              </a>
            </div>
          </div>
        </div>

        <!-- Gestion des Contenus -->
        <div class="col-md-4">
          <div class="dashboard-card content-management">
            <div class="card-header">
              <i class="fas fa-book card-icon"></i>
              {% if lang == 'en' %}Content Management{% else %}Gestion des Contenus{% endif %}
            </div>
            <div class="card-body">
              <a href="/admin/ajouter-niveau" class="btn action-btn">
                <i class="fas fa-layer-group"></i>
                {% if lang == 'en' %}Add Level{% else %}Ajouter un Niveau{% endif %}
              </a>
              <a href="/admin/ajouter-matiere" class="btn action-btn">
                <i class="fas fa-book-open"></i>
                {% if lang == 'en' %}Add Subject{% else %}Ajouter une Mati√®re{% endif %}
              </a>
              <a href="/admin/ajouter-unite" class="btn action-btn">
                <i class="fas fa-cube"></i>
                {% if lang == 'en' %}Add Unit{% else %}Ajouter une Unit√©{% endif %}
              </a>
              <a href="/admin/ajouter-lecon" class="btn action-btn">
                <i class="fas fa-file-alt"></i>
                {% if lang == 'en' %}Add Lesson{% else %}Ajouter une Le√ßon{% endif %}
              </a>
            </div>
          </div>
        </div>

        <!-- √âvaluations -->
        <div class="col-md-4">
          <div class="dashboard-card evaluations">
            <div class="card-header">
              <i class="fas fa-clipboard-check card-icon"></i>
              {% if lang == 'en' %}Evaluations{% else %}√âvaluations{% endif %}
            </div>
            <div class="card-body">
              <a href="/admin/ajouter-exercice" class="btn action-btn">
                <i class="fas fa-edit"></i>
                {% if lang == 'en' %}Add Exercise{% else %}Ajouter un Exercice{% endif %}
              </a>
              <a href="/admin/exercices" class="btn action-btn">
                <i class="fas fa-list"></i>
                {% if lang == 'en' %}Manage Exercises{% else %}G√©rer les Exercices{% endif %}
              </a>
              <a href="/admin/creer-exercice-ia" class="btn action-btn">
                <i class="fas fa-robot"></i>
                {% if lang == 'en' %}Generate Exercises (AI){% else %}G√©n√©rer des Exercices (IA){% endif %}
              </a>
              <a href="/admin/ajouter-test" class="btn action-btn">
                <i class="fas fa-vial"></i>
                {% if lang == 'en' %}Add Summative Test{% else %}Ajouter un Test Sommatif{% endif %}
              </a>
              <a href="/admin/creer-test-sommatif-ia" class="btn action-btn">
                <i class="fas fa-magic"></i>
                {% if lang == 'en' %}Generate Summative Test (AI){% else %}G√©n√©rer un Test Sommatif (IA){% endif %}
              </a>
              <a href="/admin/tests" class="btn action-btn">
                <i class="fas fa-list"></i>
                {% if lang == 'en' %}View All Tests{% else %}Voir tous les Tests{% endif %}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Onglet Structure du Contenu - ACCORD√âON IMBRIQU√â -->
    <div class="tab-pane fade" id="content" role="tabpanel">
      <div class="content-section mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="mb-0">{% if lang == 'en' %}Content Hierarchy{% else %}Hi√©rarchie du Contenu{% endif %}</h4>
          <div class="content-actions">
            <button class="btn btn-sm btn-outline-primary" id="expandAllBtn">
              <i class="fas fa-expand-alt me-1"></i>
              {% if lang == 'en' %}Expand All{% else %}Tout D√©velopper{% endif %}
            </button>
            <button class="btn btn-sm btn-outline-secondary" id="collapseAllBtn">
              <i class="fas fa-compress-alt me-1"></i>
              {% if lang == 'en' %}Collapse All{% else %}Tout R√©duire{% endif %}
            </button>
          </div>
        </div>
        
        {% if niveaux %}
          <div class="nested-accordion" id="mainAccordion">
            {% for niveau in niveaux %}
              <!-- Niveau -->
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingNiveau{{ niveau.id }}">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNiveau{{ niveau.id }}" aria-expanded="false">
                    <div class="accordion-header-content">
                      <div class="accordion-title">
                        <div class="accordion-icon level-icon">
                          <i class="fas fa-layer-group"></i>
                        </div>
                        <div>
                          <h6 class="mb-0">{{ niveau.nom_en if lang == 'en' and niveau.nom_en else niveau.nom }}</h6>
                          <small class="text-muted">
                            {% if niveau.matieres|length == 1 %}
                              {{ niveau.matieres|length }} {% if lang == 'en' %}subject{% else %}mati√®re{% endif %}
                            {% else %}
                              {{ niveau.matieres|length }} {% if lang == 'en' %}subjects{% else %}mati√®res{% endif %}
                            {% endif %}
                          </small>
                        </div>
                      </div>
                      <div class="accordion-info">
                        <span class="badge-count">{{ niveau.matieres|length }}</span>
                        <div class="accordion-actions">
                          <a href="/admin/modifier-niveau/{{ niveau.id }}" class="action-button edit-btn" 
                             data-bs-toggle="tooltip" title="{% if lang == 'en' %}Edit level{% else %}Modifier le niveau{% endif %}">
                            <i class="fas fa-edit"></i>
                          </a>
                          <button class="action-button delete-btn" 
                                  onclick="confirmDeleteNiveau({{ niveau.id }}, '{{ niveau.nom|escapejs }}')"
                                  data-bs-toggle="tooltip" title="{% if lang == 'en' %}Delete level{% else %}Supprimer le niveau{% endif %}">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  </button>
                </h2>
                <div id="collapseNiveau{{ niveau.id }}" class="accordion-collapse collapse" data-bs-parent="#mainAccordion">
                  <div class="accordion-body p-0">
                    {% if niveau.matieres %}
                      <div class="level-2-accordion" id="subAccordionNiveau{{ niveau.id }}">
                        {% for matiere in niveau.matieres %}
                          <!-- Mati√®re -->
                          <div class="accordion-item">
                            <h2 class="accordion-header" id="headingMatiere{{ matiere.id }}">
                              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMatiere{{ matiere.id }}">
                                <div class="accordion-header-content">
                                  <div class="accordion-title">
                                    <div class="accordion-icon subject-icon">
                                      <i class="fas fa-book"></i>
                                    </div>
                                    <div>
                                      <h6 class="mb-0">{{ matiere.nom_en if lang == 'en' and matiere.nom_en else matiere.nom }}</h6>
                                      <small class="text-muted">
                                        {% if matiere.unites|length == 1 %}
                                          {{ matiere.unites|length }} {% if lang == 'en' %}unit{% else %}unit√©{% endif %}
                                        {% else %}
                                          {{ matiere.unites|length }} {% if lang == 'en' %}units{% else %}unit√©s{% endif %}
                                        {% endif %}
                                      </small>
                                    </div>
                                  </div>
                                  <div class="accordion-info">
                                    <span class="badge-count">{{ matiere.unites|length }}</span>
                                    <div class="accordion-actions">
                                      <a href="{{ url_for('modifier_matiere', id=matiere.id) }}" class="action-button edit-btn"
                                         data-bs-toggle="tooltip" title="{% if lang == 'en' %}Edit subject{% else %}Modifier la mati√®re{% endif %}">
                                        <i class="fas fa-edit"></i>
                                      </a>
                                      <button class="action-button delete-btn" 
                                              onclick="confirmDeleteMatiere({{ matiere.id }}, '{{ matiere.nom|escapejs }}')"
                                              data-bs-toggle="tooltip" title="{% if lang == 'en' %}Delete subject{% else %}Supprimer la mati√®re{% endif %}">
                                        <i class="fas fa-trash"></i>
                                      </button>
                                    </div>
                                  </div>
                                </div>
                              </button>
                            </h2>
                            <div id="collapseMatiere{{ matiere.id }}" class="accordion-collapse collapse" data-bs-parent="#subAccordionNiveau{{ niveau.id }}">
                              <div class="accordion-body p-0">
                                {% if matiere.unites %}
                                  <div class="level-3-accordion" id="unitAccordionMatiere{{ matiere.id }}">
                                    {% for unite in matiere.unites %}
                                      <!-- Unit√© -->
                                      <div class="accordion-item">
                                        <h2 class="accordion-header" id="headingUnite{{ unite.id }}">
                                          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUnite{{ unite.id }}">
                                            <div class="accordion-header-content">
                                              <div class="accordion-title">
                                                <div class="accordion-icon unit-icon">
                                                  <i class="fas fa-cube"></i>
                                                </div>
                                                <div>
                                                  <h6 class="mb-0">{{ unite.nom_en if lang == 'en' and unite.nom_en else unite.nom }}</h6>
                                                  <small class="text-muted">
                                                    {% if unite.lecons|length == 1 %}
                                                      {{ unite.lecons|length }} {% if lang == 'en' %}lesson{% else %}le√ßon{% endif %}
                                                    {% else %}
                                                      {{ unite.lecons|length }} {% if lang == 'en' %}lessons{% else %}le√ßons{% endif %}
                                                    {% endif %}
                                                  </small>
                                                </div>
                                              </div>
                                              <div class="accordion-info">
                                                <span class="badge-count">{{ unite.lecons|length }}</span>
                                                <div class="accordion-actions">
                                                  <button class="action-button delete-btn" 
                                                          onclick="confirmDeleteUnite({{ unite.id }}, '{{ unite.nom|escapejs }}')"
                                                          data-bs-toggle="tooltip" title="{% if lang == 'en' %}Delete unit{% else %}Supprimer l'unit√©{% endif %}">
                                                    <i class="fas fa-trash"></i>
                                                  </button>
                                                </div>
                                              </div>
                                            </div>
                                          </button>
                                        </h2>
                                        <div id="collapseUnite{{ unite.id }}" class="accordion-collapse collapse" data-bs-parent="#unitAccordionMatiere{{ matiere.id }}">
                                          <div class="accordion-body p-0">
                                            <!-- Tests de l'unit√© -->
                                            {% if unite.tests %}
                                              <div class="tests-section">
                                                <h6 class="mb-3 d-flex align-items-center">
                                                  <div class="accordion-icon test-icon me-2">
                                                    <i class="fas fa-vial"></i>
                                                  </div>
                                                  <span>{% if lang == 'en' %}Summative Tests{% else %}Tests Sommatifs{% endif %}</span>
                                                </h6>
                                                {% for test in unite.tests %}
                                                  <div class="test-item">
                                                    <div class="d-flex align-items-center">
                                                      <i class="fas fa-vial text-warning me-2"></i>
                                                      <span>{% if lang == 'en' %}Test #{{ test.id }}{% else %}Test #{{ test.id }}{% endif %}</span>
                                                    </div>
                                                    <div class="d-flex gap-2">
                                                      <a href="/admin/visualiser-test-sommatif/{{ test.id }}" class="action-button view-btn"
                                                         data-bs-toggle="tooltip" title="{% if lang == 'en' %}View test{% else %}Voir le test{% endif %}">
                                                        <i class="fas fa-eye"></i>
                                                      </a>
                                                      <a href="/admin/modifier-test/{{ test.id }}" class="action-button edit-btn"
                                                         data-bs-toggle="tooltip" title="{% if lang == 'en' %}Edit test{% else %}Modifier le test{% endif %}">
                                                        <i class="fas fa-edit"></i>
                                                      </a>
                                                    </div>
                                                  </div>
                                                {% endfor %}
                                              </div>
                                            {% endif %}
                                            
                                            <!-- Le√ßons de l'unit√© -->
                                            {% if unite.lecons %}
                                              <div class="level-4-accordion" id="lessonAccordionUnite{{ unite.id }}">
                                                {% for lecon in unite.lecons %}
                                                  <!-- Le√ßon -->
                                                  <div class="accordion-item">
                                                    <h2 class="accordion-header" id="headingLecon{{ lecon.id }}">
                                                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLecon{{ lecon.id }}">
                                                        <div class="accordion-header-content">
                                                          <div class="accordion-title">
                                                            <div class="accordion-icon lesson-icon">
                                                              <i class="fas fa-file-alt"></i>
                                                            </div>
                                                            <div>
                                                              <h6 class="mb-0">{{ lecon.titre_en if lang == 'en' and lecon.titre_en else lecon.titre_fr|truncate(30) }}</h6>
                                                              <small class="text-muted">
                                                                {% if lecon.exercices|length == 1 %}
                                                                  {{ lecon.exercices|length }} {% if lang == 'en' %}exercise{% else %}exercice{% endif %}
                                                                {% else %}
                                                                  {{ lecon.exercices|length }} {% if lang == 'en' %}exercises{% else %}exercices{% endif %}
                                                                {% endif %}
                                                              </small>
                                                            </div>
                                                          </div>
                                                          <div class="accordion-info">
                                                            <span class="badge-count">{{ lecon.exercices|length }}</span>
                                                            <div class="accordion-actions">
                                                              <a href="/admin/modifier-lecon/{{ lecon.id }}" class="action-button edit-btn"
                                                                 data-bs-toggle="tooltip" title="{% if lang == 'en' %}Edit lesson{% else %}Modifier la le√ßon{% endif %}">
                                                                <i class="fas fa-edit"></i>
                                                              </a>
                                                              <button class="action-button delete-btn" 
                                                                      onclick="confirmDeleteLecon({{ lecon.id }}, '{{ lecon.titre_fr|escapejs|truncate(30) }}')"
                                                                      data-bs-toggle="tooltip" title="{% if lang == 'en' %}Delete lesson{% else %}Supprimer la le√ßon{% endif %}">
                                                                <i class="fas fa-trash"></i>
                                                              </button>
                                                            </div>
                                                          </div>
                                                        </div>
                                                      </button>
                                                    </h2>
                                                    <div id="collapseLecon{{ lecon.id }}" class="accordion-collapse collapse" data-bs-parent="#lessonAccordionUnite{{ unite.id }}">
                                                      <div class="accordion-body">
                                                        <!-- Exercices de la le√ßon -->
                                                        {% if lecon.exercices %}
                                                          <div class="exercises-container">
                                                            <h6 class="mb-3">{% if lang == 'en' %}Exercises{% else %}Exercices{% endif %}</h6>
                                                            {% for exercice in lecon.exercices %}
                                                              <div class="exercise-item">
                                                                <div class="exercise-info">
                                                                  <small class="text-muted">
                                                                    {% if lang == 'en' %}
                                                                      {{ exercice.question_en[:60] if exercice.question_en else exercice.question_fr[:60] }}...
                                                                    {% else %}
                                                                      {{ exercice.question_fr[:60] if exercice.question_fr else exercice.question_en[:60] }}...
                                                                    {% endif %}
                                                                  </small>
                                                                </div>
                                                                <div class="d-flex gap-2">
                                                                  <a href="/admin/modifier-exercice/{{ exercice.id }}" class="action-button edit-btn"
                                                                     data-bs-toggle="tooltip" title="{% if lang == 'en' %}Edit exercise{% else %}Modifier l'exercice{% endif %}">
                                                                    <i class="fas fa-edit"></i>
                                                                  </a>
                                                                  <button class="action-button delete-btn" 
                                                                          onclick="confirmDeleteExercice({{ exercice.id }})"
                                                                          data-bs-toggle="tooltip" title="{% if lang == 'en' %}Delete exercise{% else %}Supprimer l'exercice{% endif %}">
                                                                    <i class="fas fa-trash"></i>
                                                                  </button>
                                                                </div>
                                                              </div>
                                                            {% endfor %}
                                                          </div>
                                                        {% else %}
                                                          <div class="empty-state p-4">
                                                            <i class="fas fa-edit empty-state-icon"></i>
                                                            <p class="mb-0">{% if lang == 'en' %}No exercises{% else %}Aucun exercice{% endif %}</p>
                                                          </div>
                                                        {% endif %}
                                                      </div>
                                                    </div>
                                                  </div>
                                                {% endfor %}
                                              </div>
                                            {% else %}
                                              <div class="empty-state p-4">
                                                <i class="fas fa-file-alt empty-state-icon"></i>
                                                <p class="mb-0">{% if lang == 'en' %}No lessons{% else %}Aucune le√ßon{% endif %}</p>
                                              </div>
                                            {% endif %}
                                          </div>
                                        </div>
                                      </div>
                                    {% endfor %}
                                  </div>
                                {% else %}
                                  <div class="empty-state p-4">
                                    <i class="fas fa-cube empty-state-icon"></i>
                                    <p class="mb-0">{% if lang == 'en' %}No units{% else %}Aucune unit√©{% endif %}</p>
                                  </div>
                                {% endif %}
                              </div>
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                    {% else %}
                      <div class="empty-state p-4">
                        <i class="fas fa-book empty-state-icon"></i>
                        <p class="mb-0">{% if lang == 'en' %}No subjects{% else %}Aucune mati√®re{% endif %}</p>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state">
            <i class="fas fa-sitemap empty-state-icon"></i>
            <h5 class="text-muted">{% if lang == 'en' %}No content hierarchy available{% else %}Aucune hi√©rarchie de contenu disponible{% endif %}</h5>
            <p class="text-muted mb-4">{% if lang == 'en' %}Start by adding levels and subjects{% else %}Commencez par ajouter des niveaux et des mati√®res{% endif %}</p>
            <a href="/admin/ajouter-niveau" class="btn btn-primary">
              <i class="fas fa-plus me-2"></i>
              {% if lang == 'en' %}Add First Level{% else %}Ajouter un premier niveau{% endif %}
            </a>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Onglet Analytics -->
    <div class="tab-pane fade" id="analytics" role="tabpanel">
      <div class="content-section mt-4">
        <h4 class="mb-3">{% if lang == 'en' %}Platform Analytics{% else %}Analytiques de la Plateforme{% endif %}</h4>
        <div class="row">
          <div class="col-md-8">
            <div class="dashboard-card">
              <div class="card-header d-flex align-items-center">
                <i class="fas fa-chart-line me-2"></i>
                {% if lang == 'en' %}Usage Statistics{% else %}Statistiques d'Utilisation{% endif %}
              </div>
              <div class="card-body">
                <!-- Graphique dynamique des √©l√®ves par niveau -->
                <canvas id="chartElevesParNiveau" height="120"></canvas>

                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script>
                  const ctx = document.getElementById('chartElevesParNiveau');

                  const data = {
                    labels: {{ eleves_par_niveau|map(attribute=0)|list|tojson }},
                    datasets: [{
                      label: '{{ "Nombre d\'√©l√®ves par niveau" if lang == "fr" else "Students per level" }}',
                      data: {{ eleves_par_niveau|map(attribute=1)|list|tojson }},
                      backgroundColor: [
                        '#4361ee', '#3fba83', '#fcc419', '#e85959', '#17a2b8', '#9b59b6', '#ff6b6b'
                      ],
                      borderWidth: 1
                    }]
                  };

                  new Chart(ctx, {
                    type: 'bar',
                    data: data,
                    options: {
                      responsive: true,
                      plugins: {
                        legend: {
                          display: false
                        },
                        title: {
                          display: true,
                          text: '{{ "R√©partition des √©l√®ves par niveau" if lang == "fr" else "Students per level" }}',
                          font: { size: 18 }
                        }
                      },
                      scales: {
                        y: { beginAtZero: true, ticks: { precision: 0 } }
                      }
                    }
                  });
                </script>

              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="dashboard-card">
              <div class="card-header d-flex align-items-center">
                <i class="fas fa-bell me-2"></i>
                {% if lang == 'en' %}Recent Activity{% else %}Activit√© R√©cente{% endif %}
              </div>
              <div class="card-body">
                <div class="activity-list">
                  <div class="activity-item d-flex mb-3">
                    <div class="activity-icon bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                      <i class="fas fa-user-plus text-white"></i>
                    </div>
                    <div>
                      <p class="mb-0">{% if lang == 'en' %}New teacher registered{% else %}Nouvel enseignant inscrit{% endif %}</p>
                      <small class="text-muted">2 hours ago</small>
                    </div>
                  </div>
                  <div class="activity-item d-flex mb-3">
                    <div class="activity-icon bg-success rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                      <i class="fas fa-book text-white"></i>
                    </div>
                    <div>
                      <p class="mb-0">{% if lang == 'en' %}New lesson added{% else %}Nouvelle le√ßon ajout√©e{% endif %}</p>
                      <small class="text-muted">5 hours ago</small>
                    </div>
                  </div>
                  <div class="activity-item d-flex mb-3">
                    <div class="activity-icon bg-warning rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                      <i class="fas fa-vial text-white"></i>
                    </div>
                    <div>
                      <p class="mb-0">{% if lang == 'en' %}New test created{% else %}Nouveau test cr√©√©{% endif %}</p>
                      <small class="text-muted">Yesterday</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Fonctions de confirmation pour la suppression
    function confirmDeleteNiveau(id, nom) {
      Swal.fire({
        title: '{% if lang == "en" %}Delete Level?{% else %}Supprimer le niveau ?{% endif %}',
        html: `{% if lang == "en" %}Are you sure you want to delete level <strong>"${nom}"</strong>?<br>All associated subjects, units, lessons, and exercises will also be deleted.{% else %}√ätes-vous s√ªr de vouloir supprimer le niveau <strong>"${nom}"</strong> ?<br>Toutes les mati√®res, unit√©s, le√ßons et exercices associ√©s seront √©galement supprim√©s.{% endif %}`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#e74c3c',
        cancelButtonColor: '#3085d6',
        confirmButtonText: '{% if lang == "en" %}Yes, delete{% else %}Oui, supprimer{% endif %}',
        cancelButtonText: '{% if lang == "en" %}Cancel{% else %}Annuler{% endif %}',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          window.location.href = '/admin/supprimer-niveau/' + id;
        }
      });
    }
    
    function confirmDeleteMatiere(id, nom) {
      Swal.fire({
        title: '{% if lang == "en" %}Delete Subject?{% else %}Supprimer la mati√®re ?{% endif %}',
        html: `{% if lang == "en" %}Are you sure you want to delete subject <strong>"${nom}"</strong>?<br>All associated units, lessons, and exercises will also be deleted.{% else %}√ätes-vous s√ªr de vouloir supprimer la mati√®re <strong>"${nom}"</strong> ?<br>Toutes les unit√©s, le√ßons et exercices associ√©s seront √©galement supprim√©s.{% endif %}`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#e74c3c',
        cancelButtonColor: '#3085d6',
        confirmButtonText: '{% if lang == "en" %}Yes, delete{% else %}Oui, supprimer{% endif %}',
        cancelButtonText: '{% if lang == "en" %}Cancel{% else %}Annuler{% endif %}',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          // Soumettre le formulaire de suppression
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = "{{ url_for('supprimer_matiere', id=0) }}".replace('/0', '/' + id);
          document.body.appendChild(form);
          form.submit();
        }
      });
    }
    
    function confirmDeleteUnite(id, nom) {
      Swal.fire({
        title: '{% if lang == "en" %}Delete Unit?{% else %}Supprimer l\'unit√© ?{% endif %}',
        html: `{% if lang == "en" %}Delete unit <strong>"${nom}"</strong>?<br>All associated lessons and exercises will also be deleted.{% else %}Supprimer l\'unit√© <strong>"${nom}"</strong> ?<br>Toutes les le√ßons et exercices associ√©s seront √©galement supprim√©s.{% endif %}`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#e74c3c',
        cancelButtonColor: '#3085d6',
        confirmButtonText: '{% if lang == "en" %}Delete{% else %}Supprimer{% endif %}',
        cancelButtonText: '{% if lang == "en" %}Cancel{% else %}Annuler{% endif %}',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          window.location.href = '/admin/supprimer-unite/' + id;
        }
      });
    }
    
    function confirmDeleteLecon(id, titre) {
      Swal.fire({
        title: '{% if lang == "en" %}Delete Lesson?{% else %}Supprimer la le√ßon ?{% endif %}',
        html: `{% if lang == "en" %}Delete lesson <strong>"${titre}"</strong>?<br>All associated exercises will also be deleted.{% else %}Supprimer la le√ßon <strong>"${titre}"</strong> ?<br>Tous les exercices associ√©s seront √©galement supprim√©s.{% endif %}`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#e74c3c',
        cancelButtonColor: '#3085d6',
        confirmButtonText: '{% if lang == "en" %}Delete{% else %}Supprimer{% endif %}',
        cancelButtonText: '{% if lang == "en" %}Cancel{% else %}Annuler{% endif %}',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          window.location.href = '/admin/supprimer-lecon/' + id;
        }
      });
    }
    
    function confirmDeleteExercice(id) {
      Swal.fire({
        title: '{% if lang == "en" %}Delete Exercise?{% else %}Supprimer l\'exercice ?{% endif %}',
        text: '{% if lang == "en" %}This action cannot be undone.{% else %}Cette action est irr√©versible.{% endif %}',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#e74c3c',
        cancelButtonColor: '#3085d6',
        confirmButtonText: '{% if lang == "en" %}Yes, delete{% else %}Oui, supprimer{% endif %}',
        cancelButtonText: '{% if lang == "en" %}Cancel{% else %}Annuler{% endif %}',
        reverseButtons: true
      }).then((result) => {
        if (result.isConfirmed) {
          fetch('/admin/supprimer-exercice/' + id, { method: 'POST' })
            .then(response => {
              if (response.redirected) {
                window.location.href = response.url;
              } else {
                Swal.fire('Erreur', 'Une erreur est survenue.', 'error');
              }
            });
        }
      });
    }
    
    // Gestion du th√®me
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = themeToggle.querySelector('i');
    
    // V√©rifier le th√®me sauvegard√© ou la pr√©f√©rence syst√®me
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    updateThemeIcon(savedTheme);
    
    themeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon(newTheme);
    });
    
    function updateThemeIcon(theme) {
      if (theme === 'dark') {
        themeIcon.className = 'fas fa-sun';
      } else {
        themeIcon.className = 'fas fa-moon';
      }
    }
    
    // Boutons Expand/Collapse All
    document.addEventListener('DOMContentLoaded', function() {
      const expandAllBtn = document.getElementById('expandAllBtn');
      const collapseAllBtn = document.getElementById('collapseAllBtn');
      
      if (expandAllBtn) {
        expandAllBtn.addEventListener('click', function() {
          const collapses = document.querySelectorAll('.accordion-collapse');
          collapses.forEach(collapse => {
            new bootstrap.Collapse(collapse, { toggle: false }).show();
          });
        });
      }
      
      if (collapseAllBtn) {
        collapseAllBtn.addEventListener('click', function() {
          const collapses = document.querySelectorAll('.accordion-collapse');
          collapses.forEach(collapse => {
            new bootstrap.Collapse(collapse, { toggle: false }).hide();
          });
        });
      }
      
      // Initialiser les tooltips
      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });
  </script>
</body>
</html>